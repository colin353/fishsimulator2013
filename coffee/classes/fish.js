// Generated by CoffeeScript 1.6.2
var Fish;

Fish = (function() {
  function Fish(filename) {
    this.filename = filename;
    this.fish_raw = sync_get('game/assets/fish/' + filename);
    if (this.fish_raw.name == null) {
      alert("Illegal fish \"" + filename + "\"");
    }
    this.type = 'fish';
    this.image = this.fish_raw.image;
    this.price = this.fish_raw.price;
    this.name = this.fish_raw.name;
    this.crustacean = this.fish_raw.crustacean;
    this.scale = 0.5;
    if (this.fish_raw.scale != null) {
      this.scale = this.fish_raw.scale;
    }
    this.description = this.fish_raw.description;
    viewcontroller.loadImages(this.image);
    this.position = {
      x: 0,
      y: 0
    };
    this.direction = {
      x: Math.random(),
      y: Math.random()
    };
  }

  Fish.prototype.salt_ok = function() {
    if (document.tank.salt > this.fish_raw.salt_max || document.tank.salt < this.fish_raw.salt_min) {
      return false;
    } else {
      return true;
    }
  };

  Fish.prototype.tick = function() {
    var flip, reverse;

    flip = this.direction.x < 0;
    viewcontroller.renderSprite(this.image, this.position.x, this.position.y, this.scale, flip);
    if (this.salt_ok() === true) {
      this.position.x += this.direction.x * 10;
      this.position.y += this.direction.y * 10;
    }
    if (document.tank.temperature < 60) {
      this.position.x += (Math.random() - 0.5) * 10;
      this.position.y += (Math.random() - 0.5) * 10;
    }
    if (this.salt_ok() === false) {
      if (this.position.y < viewcontroller.canvas.height - 0.5 * viewcontroller.images[this.image].image.height - 50) {
        this.position.y += 0.5;
      }
    }
    if (this.position.x > viewcontroller.canvas.width - 0.5 * viewcontroller.images[this.image].image.width || this.position.x < 0) {
      if (this.position.x < 0) {
        reverse = 1;
      } else {
        reverse = -1;
      }
      this.direction.x = Math.abs(this.direction.x) * reverse;
      if (this.salt_ok()) {
        this.direction.y = Math.random() - 0.5;
      }
    }
    if (this.position.y > viewcontroller.canvas.height - 0.5 * viewcontroller.images[this.image].image.height - 50 || this.position.y < 0) {
      if (this.position.y < 0) {
        reverse = 1;
      } else {
        reverse = -1;
      }
      this.direction.y = Math.abs(this.direction.y) * reverse;
      if (this.salt_ok()) {
        this.direction.x = Math.random() - 0.5;
      }
    }
    if (this.crustacean === 1) {
      this.position.y = viewcontroller.canvas.height - 0.5 * viewcontroller.images[this.image].image.height - 120;
    }
    return document.tank.waste += 0.02;
  };

  return Fish;

})();
